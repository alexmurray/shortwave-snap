name: shortwave
version: 1.0.1
summary: Find and listen to internet radio stations
description: |
 Shortwave is an internet radio player that provides access to a station
 database with over 25,000 stations.
adopt-info: shortwave
base: core18
grade: stable
confinement: strict
license: GPL-3.0+

slots:
  # for GtkApplication registration
  shortwave:
    interface: dbus
    bus: session
    name: de.haeckerfelix.Shortwave

environment:
  XDG_DATA_DIRS: $SNAP/share:$XDG_DATA_DIRS

apps:
  shortwave:
    command: shortwave
    extensions: [gnome-3-34]
    plugs:
      - home
      - network
      - audio-playback
    desktop: usr/share/applications/de.haeckerfelix.Shortwave

parts:
  shortwave:
    source: https://gitlab.gnome.org/World/Shortwave/uploads/c2d6a38025e1bf255bbb5fed58b0ffbc/shortwave-1.0.1.tar.xz
    plugin: meson
    meson-parameters: [--prefix=/snap/shortwave/current/usr]
    organize:
      snap/shortwave/current/usr: usr
    build-packages:
      - intltool
      - gettext
      - gnome-common
      - libgtk-3-dev
      - rustc
      - libsqlite3-dev
      - libssl-dev
      # this should provide /usr/share/gettext/its/appdata.its but it
      # doesn't seem to exist anywhere in the debian package...
      - libappstream-glib-dev
      - libappstream-dev
      - libgstreamer1.0-dev
      - libgstreamer-plugins-base1.0-dev
      - libgstreamer-plugins-bad1.0-dev
      - git
    override-build: |
      # try using gtk 3.24.10 rather than 3.24.11
      sed -i 's|3.24.11|3.24.10|' meson.build
      sed -i 's|1.16|1.14.5|' meson.build
      snapcraftctl build
      snapcraftctl set-icon data/icons/hicolor/scalable/apps/de.haeckerfelix.Shortwave.svg

    # override-prime: |
    #   set -eu
    #   snapcraftctl prime
    #   # Fix-up application icon lookup
    #   sed -i.bak -e 's|^Icon=.*|Icon=${SNAP}/meta/gui/icon.png|g' usr/share/applications/indicator-sensors.desktop
